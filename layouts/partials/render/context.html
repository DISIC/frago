{{- $context := .context -}}
{{- $project := .project -}}
{{- $rootpath := (partialCached "render/rootpath" (dict "context" $context "project" $project "type" "accessibility") $project "accessibility") -}}
{{- if fileExists (printf "%s/%s/accessibility" $rootpath $project) -}}
  {{- range $id, $value := readDir (printf "%s/%s/accessibility" $rootpath $project) -}}
    {{- if eq .Name "context.yml" -}}
      {{- $file := ((readFile (printf "%s/%s/accessibility/%s" $rootpath $project .Name) | transform.Unmarshal)) -}}
      {{- range $date, $value := $file.audits -}}
      {{- $context.Scratch.SetInMap "context" $date (dict "contacts" $file.contacts "website" $file.website "audit" (index $file.audits $date)) -}}
      {{- end -}}
    {{- else -}}
    {{- $context.Scratch.Set "date" (replace .Name (path.Ext .Name) "") -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
{{- if not ($context.Scratch.Get "context") -}}
{{/* In a front matter of the current page */}}
{{- with $context.GetPage (printf "/audits/%s/_index.md" $project) -}}{{ $context.Scratch.SetInMap "context" ($context.Scratch.Get "date") (dict "contacts" .Params.accessibility.contacts "website" .Params.accessibility.website "audit" (.Params.accessibility.audit)) }}{{- end -}}
{{- with $context.GetPage (printf "/audits/%s/index.md" $project)  -}}{{ $context.Scratch.SetInMap "context" ($context.Scratch.Get "date") (dict "contacts" .Params.accessibility.contacts "website" .Params.accessibility.website "audit" (.Params.accessibility.audit)) }}{{- end -}}
{{/* In a file name accessibility.md presents i the project folder  */}}
{{- with $context.GetPage (printf "/audits/%s/accessibility.md" $project) -}}{{ $context.Scratch.SetInMap "context" ($context.Scratch.Get "date") (dict "contacts" .Params.accessibility.contacts "website" .Params.accessibility.website "audit" (.Params.accessibility.audit)) }}{{- end -}}
{{- end -}}
{{- return ($.context.Scratch.Get "context") -}}
